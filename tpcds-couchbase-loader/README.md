# Introduction
This tool generates TPC-DS data and loads it into the Couchbase bucket. The tool can be configured through a `properties`
file or `command line arguments`. If both are provided, the `properties` file values are read first, and are overwritten
with the `command line arguments` to ease the configuration when running multiple instances. Based on the provided
parameters, it is possible to generate all the data on a single instance running multiple threads, or generate the
data on multiple partitions. This configuration is done using the `partitions` and `partition` properties, which is
explained further below.

# Parameters
The tool reads the parameters from `properties` file and `command line arguments`, if both are provided, the `command
line arguments` overwrite the `properties` parameters. The parameter names are case-insensitive. Below is the list of
the configurable parameters:

`propertiesfilepath`: The path to the properties file to be used for reading the configurations. If not provided, the
the default properties file is used.

`hostname`: The host name of the Couchbase server to connect to, default value is `localhost`.

`port`: The port number of the Couchbase server to connect to, if not provided, SDK uses the default value.

`username`: The username of the Couchbase server to connect to, default value is `Administrator`.

`password`: The password of the Couchbase server to connect to, default value is `couchbase`.

`bucket`: The name of the bucket to load the data into, default value is `tpcds`.

`isdeleteifbucketexists (Temporarily disabled)`: Deletes the bucket if it already exists, and re-creates it to ensure
the bucket is empty before loading the data. The bucket name used is the argument value `bucket` passed. The default
value is `true`.

`memoryquota (Temporarily disabled)`: Memory quota of the bucket in megabytes, default value is `4096 (4GB)`.

`batchlimit`: The number of records to generate before doing a batch upsert operation, default value is `10,000`.

`scalefactor`: The scale factor provided to the TPC-DS data generator. The scale factor determines the data size
to be generated, the default value is `1 (1GB of data)`.

`partitions`: The number of partitions that the generator will run on. This will indicate to the TPC-DS generator how
the data needs to be split to be generated in partitions, the default value is `2`.

`partition (starts at 1)`: The number of the partition to be generated by the TPC-DS generator. Example, running two
instances with `partitions=2`, one with `partition=1` and the other with `partition=2`. The first instance will generate
the first partition (approximately 50% of the data), while the other instances will generate the rest. `partitions` and
`partition` properties go hand in hand to indicate what partition of the data to be generated. The default value is
`-1`, which indicates that the current instances will generate all the data alone.

`kvendpoints`: The number of KV endpoints to be used by the Couchbase server. Increasing the KV endpoints would improve
the throughput performance, the default value is `2`.

`kvtimeout`: The time it takes for an upsert operation to timeout and fail. Time is in milliseconds, default value is
`10000 (10 seconds)`.

`failureretrydelay`: The time delay to retry in case of a failure upsert operation. Time is in milliseconds, default
value is `5000 (5 seconds)`.

`failuremaximumretries`: The number of times to retry in case of a failure upsert, default value is `10`.

`enablepadding`: Enable padding (trailing white spaces) in generated strings if required by the TPC-DS generator,
default value is `false`.

# How To Use
## Generating the JAR file
To generate the executable JAR file which will be used to run the Loader, follow the these steps:
- Ensure Maven is installed on your machine.
- Navigate to the root directory of the project.
- Run the command `mvn install` at the root of the project.
- `tpcds.jar` is generated in the folder `cbas-perf-support/tpcds-couchbase-loader/target`. This JAR file is all that is
needed to run the data generator. Details can be found in the example below. The JAR file can be moved to any location
for convenience if needed.

## Running the JAR file
The tool can be run on a single partition to generate the data, or multiple partitions. The `partitions` property should
match the number of partitions that will be used to generate the data. The `partitions` property tells the TPC-DS
generator about the number of partitions that will need to be generated, and the TPC-DS will adjust the data generation
accordingly. The `partition` property will indicate the partition to be generated. A detailed example can be found below.

#### Important
Two of the properties are currently disabled, namely `isdeleteifbucketexists` and `memoryquota`. Because of that, to
get a correct result, a bucket needs to be created ahead of time, and needs to be empty. The bucket name should match
the `bucket` property value which the tool will write to.

#### Example
Assuming we are going to run on `3 client machines`, and generate the data on `5` partitions. The first 2 clients will
generate 2 partitions each, and the third client will generate 1 partition.

#### Notes
- The `partitions` property needs to match the total number of partitions to be generated, and needs
to be provided to all instances. This property indicates to the TPC-DS generator how to generate the data.
- Each client machine needs to be provided the `partition` property for the partition it is going to generate.
- The total partitions is `5`, and it is generating a scale factor of `1` (1GB of data).

**Client machine 1** generating partitions `1` and `2`:
```
java -jar tpcds.jar partitions=5 partition=1 scalefactor=1
java -jar tpcds.jar partitions=5 partition=2 scalefactor=1
```

**Client machine 2** generating partitions `3` and `4`:
```
java -jar tpcds.jar partitions=5 partition=3 scalefactor=1
java -jar tpcds.jar partitions=5 partition=4 scalefactor=1
```

**Client machine 3** generating partitions `5`:
```
java -jar tpcds.jar partitions=5 partition=5 scalefactor=1
```